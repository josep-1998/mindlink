<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MindLink â€” Full Version</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
:root{
  --bg:#07070a; --panel:#0f1114; --text:#e6eef8;
  --accent:#00d1ff; --accent2:#8a4cff; --muted:#9aa3b2;
}
*{box-sizing:border-box;font-family:Inter,Roboto,Arial;margin:0;padding:0}
body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px;}
.app{width:100%;max-width:920px;border-radius:12px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);box-shadow:0 20px 60px rgba(0,0,0,0.6);}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.brand{font-weight:800;font-size:20px;color:var(--accent);letter-spacing:0.6px}
.controls{display:flex;gap:8px;align-items:center;}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#06101a;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;}
.small{padding:8px 10px;font-size:13px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
.row{display:flex;gap:12px;align-items:center}

/* main layout */
.main{display:flex;gap:18px;align-items:flex-start;}
.left{flex:1;min-width:320px}
.right{width:320px}

/* board */
.board{width:100%;max-width:420px;padding:16px;border-radius:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);}
.tile{position:relative;padding-top:100%;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;overflow:hidden;transition:transform .12s, box-shadow .12s}
.tile.inner{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px}
.tile.active{transform:scale(1.03);box-shadow:0 18px 40px rgba(0,0,0,0.6);}

/* status */
.status{display:flex;justify-content:space-between;margin-top:12px;align-items:center}
.info{color:var(--muted);font-size:14px}
.lives{color:#ffd1d1;font-weight:700}

/* menu / footer */
.panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);margin-bottom:12px;color:var(--muted)}
.theme-switch{display:flex;gap:8px;flex-wrap:wrap}
.theme-btn{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted)}

.brand small{display:block;color:var(--muted);font-weight:600;font-size:12px;margin-top:-2px}

/* animations for neon theme */
.theme-cyber .tile { background: linear-gradient(135deg, rgba(0,209,255,0.03), rgba(138,76,255,0.02)); border:1px solid rgba(0,209,255,0.06) }
.theme-minimal .tile { background: linear-gradient(180deg,#f0f0f0,#e8e8e8); color:#000 }
.theme-gamer .tile { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2)) }
.theme-matrix .tile { background: linear-gradient(180deg,#012200,#001400); color:#c8ffbd }

/* small responsive */
@media(max-width:900px){ .main{flex-direction:column} .right{width:100%} .board{order:2} .brand{font-size:18px}}
</style>
</head>
<body>
<div class="app theme-cyber" id="app">
  <div class="header">
    <div class="brand">MindLink <small>â€” Evoluciona tu eco</small></div>
    <div class="controls row">
      <div class="info" id="modeLabel">Modo: Normal</div>
      <button class="btn" id="startBtn">Iniciar</button>
      <button class="small" id="muteBtn">ðŸ”ˆ MÃºsica ON</button>
    </div>
  </div>

  <div class="main">
    <div class="left">
      <div id="board" class="board" aria-live="polite" aria-label="Tablero de MindLink"></div>

      <div class="status">
        <div class="info">Nivel: <span id="level">1</span></div>
        <div class="info">PuntuaciÃ³n: <span id="score">0</span></div>
        <div class="lives">Vidas: <span id="lives">3</span></div>
      </div>

      <div style="margin-top:12px" class="panel">
        <strong>CÃ³mo jugar:</strong> Observa la secuencia, repÃ­tela. Cada nivel aumenta la secuencia. Ganas puntos por cada ronda completada.
      </div>
    </div>

    <div class="right">
      <div class="panel">
        <h4>Opciones</h4>
        <div style="margin-top:8px" class="theme-switch">
          <button class="theme-btn" data-theme="cyber">Cyber</button>
          <button class="theme-btn" data-theme="minimal">Minimal</button>
          <button class="theme-btn" data-theme="gamer">Gamer</button>
          <button class="theme-btn" data-theme="matrix">Matrix</button>
        </div>
        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.02)">
        <label style="display:block;margin-bottom:8px">Modo difÃ­cil: <input type="checkbox" id="hardMode"></label>
        <label style="display:block;margin-bottom:8px">Sonidos: <input type="checkbox" id="sfxToggle" checked></label>
        <label style="display:block;margin-bottom:8px">Autoguardar: <input type="checkbox" id="autosaveToggle" checked></label>
      </div>

      <div class="panel">
        <h4>Logros</h4>
        <ul id="achievements" style="list-style:none;padding-left:0;color:var(--muted);font-size:14px"></ul>
      </div>

      <div class="panel">
        <h4>Leaderboard (local)</h4>
        <ol id="leaderboard" style="color:var(--muted);padding-left:18px"></ol>
        <button class="small" id="shareBtn" style="margin-top:8px">Compartir PuntuaciÃ³n</button>
      </div>

    </div>
  </div>
</div>

<!-- Audio assets (base64 small beeps to avoid external files) -->
<audio id="music" loop>
  <source src="data:audio/mpeg;base64,//uQx..." type="audio/mpeg">
  <!-- Placeholder, browsers require real audio; we'll set fallback synthesized tones -->
</audio>

<script>
/* =========================
   MindLink - Full Feature JS
   ========================= */

/* Config */
const BOARD_SIZE = 9; // 3x3
const START_LIVES = 3;
const ACHIEVEMENTS = [
  {id:'first_win', text:'Gana tu primera ronda', cond: s=>s>=1},
  {id:'level_5', text:'Alcanza el nivel 5', cond: l=>l>=5},
  {id:'level_10', text:'Alcanza el nivel 10', cond: l=>l>=10},
];

/* State */
let sequence = [];
let playerPos = 0;
let level = 1;
let score = 0;
let lives = START_LIVES;
let playing = false;
let acceptingInput = false;
let hardMode = false;
let sfxOn = true;
let autosave = true;

/* DOM */
const app = document.getElementById('app');
const boardEl = document.getElementById('board');
const startBtn = document.getElementById('startBtn');
const levelEl = document.getElementById('level');
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const achievementsEl = document.getElementById('achievements');
const leaderboardEl = document.getElementById('leaderboard');
const modeLabel = document.getElementById('modeLabel');
const muteBtn = document.getElementById('muteBtn');

/* SFX using WebAudio for reliable tones */
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
function tone(freq, t=120){
  if(!sfxOn) return;
  try{
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.15, audioCtx.currentTime + 0.01);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + t/1000);
    setTimeout(()=>o.stop(), t+50);
  }catch(e){}
}

/* helpers */
function wait(ms){return new Promise(r=>setTimeout(r,ms));}
function randInt(n){return Math.floor(Math.random()*n);}

/* Create board tiles */
let tiles = [];
function createBoard(){
  boardEl.innerHTML='';
  boardEl.style.gridTemplateColumns = 'repeat(3,1fr)';
  tiles = [];
  for(let i=0;i<BOARD_SIZE;i++){
    const t = document.createElement('div');
    t.className = 'tile';
    t.setAttribute('data-index', i);
    const inner = document.createElement('div'); inner.className='inner';
    inner.textContent = '';
    t.appendChild(inner);
    t.addEventListener('click', ()=> onTileClick(i));
    boardEl.appendChild(t);
    tiles.push(t);
  }
}

/* Visual highlight */
function highlight(i, ms=400){
  const el = tiles[i];
  if(!el) return;
  el.classList.add('active');
  // set a tone based on index
  const freqs = [420,520,620,720,840,940,1020,1120,1220];
  tone(freqs[i % freqs.length], Math.max(120, ms-50));
  setTimeout(()=>el.classList.remove('active'), ms);
}

/* Sequence display (with ghost eco optionally) */
async function showSequence(seq){
  acceptingInput = false;
  let speed = Math.max(220, 700 - (level*10));
  if(hardMode) speed = Math.max(180, speed-80);
  for(let i=0;i<seq.length;i++){
    highlight(seq[i], Math.max(160, speed-40));
    await wait(speed);
  }
  acceptingInput = true;
}

/* Game flow */
async function startGame(){
  playing = true;
  sequence = [];
  playerPos = 0;
  level = 1;
  score = 0;
  lives = START_LIVES;
  updateUI();
  await nextLevel();
}

async function nextLevel(){
  levelEl.textContent = level;
  // extend the sequence (in hard mode add 2 sometimes)
  sequence.push(randInt(BOARD_SIZE));
  playerPos = 0;
  await wait(300);
  await showSequence(sequence);
}

function updateUI(){
  levelEl.textContent = level;
  scoreEl.textContent = score;
  livesEl.textContent = lives;
  modeLabel.textContent = hardMode ? 'Modo: DifÃ­cil' : 'Modo: Normal';
}

/* Handle tile click */
function onTileClick(i){
  if(!playing || !acceptingInput) return;
  highlight(i, 160);
  if(i === sequence[playerPos]){
    playerPos++;
    if(playerPos === sequence.length){
      // success
      score += sequence.length * (hardMode ? 2 : 1);
      // achievements
      checkAchievements();
      level++;
      updateUI();
      if(autosave) saveProgress();
      setTimeout(()=> nextLevel(), 700);
    }
  } else {
    // fail
    lives--;
    updateUI();
    tone(180, 300);
    if(lives <= 0){
      gameOver();
    } else {
      // replay same level
      playerPos = 0;
      acceptingInput = false;
      setTimeout(()=> showSequence(sequence), 800);
    }
  }
}

/* Game over */
function gameOver(){
  playing = false;
  acceptingInput = false;
  alert(`Game Over â€” PuntuaciÃ³n: ${score}`);
  saveToLeaderboard(score);
  if(autosave) saveProgress(true); // save final
}

/* Achievements */
function checkAchievements(){
  const earned = JSON.parse(localStorage.getItem('mindlink_ach') || '[]');
  let changed = false;
  ACHIEVEMENTS.forEach(a=>{
    if(!earned.includes(a.id)){
      const cond = (a.id.startsWith('level_') ? level : null);
      const ok = a.id==='first_win' ? score>=1 : (a.id==='level_5' ? level>=5 : (a.id==='level_10' ? level>=10 : false));
      if(ok){
        earned.push(a.id); changed = true;
        // simple notification
        (async ()=>{ tone(950,200); alert('ðŸ† Logro desbloqueado: '+a.text); })();
      }
    }
  });
  if(changed) localStorage.setItem('mindlink_ach', JSON.stringify(earned));
  renderAchievements();
}
function renderAchievements(){
  const earned = JSON.parse(localStorage.getItem('mindlink_ach') || '[]');
  achievementsEl.innerHTML = '';
  ACHIEVEMENTS.forEach(a=>{
    const li = document.createElement('li');
    li.textContent = (earned.includes(a.id) ? 'âœ… ' : 'â¬œ ') + a.text;
    achievementsEl.appendChild(li);
  });
}

/* Local leaderboard */
function saveToLeaderboard(points){
  try{
    const lb = JSON.parse(localStorage.getItem('mindlink_lb')||'[]');
    lb.push({score: points, at: Date.now()});
    lb.sort((a,b)=>b.score-a.score);
    localStorage.setItem('mindlink_lb', JSON.stringify(lb.slice(0,20)));
    renderLeaderboard();
  }catch(e){}
}
function renderLeaderboard(){
  const lb = JSON.parse(localStorage.getItem('mindlink_lb')||'[]');
  leaderboardEl.innerHTML='';
  if(lb.length===0){ leaderboardEl.innerHTML = '<li style="color:var(--muted)">Sin puntuaciones</li>'; return; }
  lb.forEach(it=>{
    const li = document.createElement('li');
    const d = new Date(it.at);
    li.textContent = `${it.score} pts â€” ${d.toLocaleString()}`;
    leaderboardEl.appendChild(li);
  });
}

/* Autosave / Load progress */
function saveProgress(final=false){
  if(!autosave) return;
  const state = {level,score,lives,sequence,playing,ts:Date.now()};
  localStorage.setItem('mindlink_save', JSON.stringify(state));
  if(final) localStorage.setItem('mindlink_last_score', score);
}
function loadProgress(){
  const s = JSON.parse(localStorage.getItem('mindlink_save') || 'null');
  if(s){
    level = s.level || 1;
    score = s.score || 0;
    lives = s.lives || START_LIVES;
    sequence = s.sequence || [];
    playing = s.playing || false;
    updateUI();
  }
}

/* Theme switching */
document.querySelectorAll('.theme-btn').forEach(b=>{
  b.addEventListener('click', ()=> {
    const t = b.getAttribute('data-theme');
    app.className = 'app theme-' + t;
  });
});

/* toggles */
document.getElementById('hardMode').addEventListener('change', (e)=>{
  hardMode = e.target.checked;
  updateUI();
});
document.getElementById('sfxToggle').addEventListener('change', (e)=>{
  sfxOn = e.target.checked;
});
document.getElementById('autosaveToggle').addEventListener('change', (e)=>{
  autosave = e.target.checked;
});

/* share */
document.getElementById('shareBtn').addEventListener('click', ()=>{
  const txt = `Mi puntuaciÃ³n en MindLink: ${score} â€” Â¿Puedes superarme? ${location.href}`;
  navigator.clipboard?.writeText(txt).then(()=> alert('Copiado al portapapeles. Â¡CompÃ¡rtelo!'));
});

/* start */
startBtn.addEventListener('click', ()=> startGame());
document.getElementById('muteBtn').addEventListener('click', ()=>{
  const m = document.getElementById('music');
  if(m.paused){ m.play(); muteBtn.textContent='ðŸ”ˆ MÃºsica ON'; } else { m.pause(); muteBtn.textContent='ðŸ”‡ MÃºsica OFF'; }
});

/* initial */
createBoard();
renderAchievements();
renderLeaderboard();
loadProgress();

/* =============
   Firebase (opcional)
   =============
   If you want a global leaderboard, create a Firebase project and enable Firestore.
   Then paste your Firebase config below and uncomment the firebase init block.
   DO NOT include real API secrets in public repos â€” use restrictions.
*/

/* Example: How to hook Firebase (instructions only)
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
  // paste your config here:
  const firebaseConfig = {
    apiKey: "...",
    authDomain: "...",
    projectId: "...",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  // Save score:
  db.collection('leaderboard').add({score: score, at: new Date(), name: 'Jugador'});
  // Read top 20:
  db.collection('leaderboard').orderBy('score','desc').limit(20).get().then(...)
</script>
*/

</script>
</body>
</html>
